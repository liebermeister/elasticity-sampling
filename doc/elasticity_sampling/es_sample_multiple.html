<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of es_sample_multiple</title>
  <meta name="keywords" content="es_sample_multiple">
  <meta name="description" content="ES_SAMPLE_MULTIPLE - Create model ensemble and collect values for an output function">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">elasticity_sampling</a> &gt; es_sample_multiple.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for elasticity_sampling&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>es_sample_multiple
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>ES_SAMPLE_MULTIPLE - Create model ensemble and collect values for an output function</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [output, output_list] = es_sample_multiple(N, W, ind_ext, es_constraints, es_options, output_function, select_function, score_function, function_args) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> ES_SAMPLE_MULTIPLE - Create model ensemble and collect values for an output function

 [output, output_list] = es_sample_multiple(N, W, ind_ext, es_constraints, es_options, output_function, select_function, score_function, function_args)

 Run elasticity sampling repeatedly, compute every time an output function 
 (any kind of matlab variable), and return a list of the output values.

 This function also allows for posterior sampling (Metropolis-Monte Carlo algorithm)

 There is no direct way to run the sampling in parallel for two scenarios
 with the same random values used for saturation constants in both ensembles

 Inputs (nm: # metabolites; nr: # reactions)
   N         - Stoichiometric matrix (nm x nr)
   W         - Allosteric regulation matrix (nr x nm)
   ind_ext   - indices of external metabolites
 
  For the inputs es_constraints and es_options, see es_default_options

  output_function - Output function for which response coefficients are sampled (*1)
  select_function - Function for filtering the sampled models (*2)
  score_function  - Function for posterior probability sampling (*3)
  function_args   - Arguments for output_function, select_function, score_function

 Outputs
  output_list     - Results as a list of matrices
  output          - Same results as a tensor

 Comments:

 (1) If the output function is numeric, output contains all values as a row vector
      (for scalars), matrix (for row or column vectors), or tensor (for matrices).

 (2) If a 'select_function' is provided, only samples that yield a non-zero value
     of this function will be considered.

 (3)  If a score function (e.g., a log likelihood) is provided, it is evaluated 
      every time for each sample and the values are used for Metropolis sampling
      instead of simple repeated sampling.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="es_sample_model.html" class="code" title="function [result, es_options, es_constraints] = es_sample_model(N, W, ind_ext, es_constraints, es_options)">es_sample_model</a>	ES_SAMPLE_MODEL - Sample all model parameters for a network</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../demo/es_demo.html" class="code" title="">es_demo</a>	ES_DEMO Demo script for thermodynamically feasible elasticity sampling</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [output, output_list] = es_sample_multiple(N, W, ind_ext, es_constraints, es_options, output_function, select_function, score_function, function_args)</a>
0002 
0003 <span class="comment">% ES_SAMPLE_MULTIPLE - Create model ensemble and collect values for an output function</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% [output, output_list] = es_sample_multiple(N, W, ind_ext, es_constraints, es_options, output_function, select_function, score_function, function_args)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% Run elasticity sampling repeatedly, compute every time an output function</span>
0008 <span class="comment">% (any kind of matlab variable), and return a list of the output values.</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% This function also allows for posterior sampling (Metropolis-Monte Carlo algorithm)</span>
0011 <span class="comment">%</span>
0012 <span class="comment">% There is no direct way to run the sampling in parallel for two scenarios</span>
0013 <span class="comment">% with the same random values used for saturation constants in both ensembles</span>
0014 <span class="comment">%</span>
0015 <span class="comment">% Inputs (nm: # metabolites; nr: # reactions)</span>
0016 <span class="comment">%   N         - Stoichiometric matrix (nm x nr)</span>
0017 <span class="comment">%   W         - Allosteric regulation matrix (nr x nm)</span>
0018 <span class="comment">%   ind_ext   - indices of external metabolites</span>
0019 <span class="comment">%</span>
0020 <span class="comment">%  For the inputs es_constraints and es_options, see es_default_options</span>
0021 <span class="comment">%</span>
0022 <span class="comment">%  output_function - Output function for which response coefficients are sampled (*1)</span>
0023 <span class="comment">%  select_function - Function for filtering the sampled models (*2)</span>
0024 <span class="comment">%  score_function  - Function for posterior probability sampling (*3)</span>
0025 <span class="comment">%  function_args   - Arguments for output_function, select_function, score_function</span>
0026 <span class="comment">%</span>
0027 <span class="comment">% Outputs</span>
0028 <span class="comment">%  output_list     - Results as a list of matrices</span>
0029 <span class="comment">%  output          - Same results as a tensor</span>
0030 <span class="comment">%</span>
0031 <span class="comment">% Comments:</span>
0032 <span class="comment">%</span>
0033 <span class="comment">% (1) If the output function is numeric, output contains all values as a row vector</span>
0034 <span class="comment">%      (for scalars), matrix (for row or column vectors), or tensor (for matrices).</span>
0035 <span class="comment">%</span>
0036 <span class="comment">% (2) If a 'select_function' is provided, only samples that yield a non-zero value</span>
0037 <span class="comment">%     of this function will be considered.</span>
0038 <span class="comment">%</span>
0039 <span class="comment">% (3)  If a score function (e.g., a log likelihood) is provided, it is evaluated</span>
0040 <span class="comment">%      every time for each sample and the values are used for Metropolis sampling</span>
0041 <span class="comment">%      instead of simple repeated sampling.</span>
0042 <span class="comment">%</span>
0043 
0044 <span class="comment">% test script: test_es_sample_multiple.m</span>
0045 
0046 
0047 eval(default(<span class="string">'select_function'</span>,<span class="string">'[]'</span>,<span class="string">'score_function'</span>,<span class="string">'[]'</span>,<span class="string">'function_args'</span>,<span class="string">'[]'</span>));
0048 
0049 <span class="keyword">if</span> es_options.set_alpha_to_half,
0050   warning(<span class="string">'Attempted ensemble sampling with fixed saturation values'</span>);
0051 <span class="keyword">end</span>
0052 
0053 <span class="comment">% -----------------------------------------------</span>
0054 <span class="comment">% run sampling algorithm</span>
0055 
0056 old_score = -inf;
0057 
0058 es_options.seed = nan;
0059 
0060 <span class="keyword">for</span> it = 1:es_options.n_samples,
0061   display(sprintf(<span class="string">'\nSample %d/%d'</span>,it,es_options.n_samples));
0062   my_result = <a href="es_sample_model.html" class="code" title="function [result, es_options, es_constraints] = es_sample_model(N, W, ind_ext, es_constraints, es_options)">es_sample_model</a>(N,W,ind_ext,es_constraints,es_options);
0063   <span class="keyword">if</span> ~isempty(select_function),
0064     accept = feval(select_function,my_result,function_args);
0065     <span class="keyword">while</span> ~accept,
0066       display(<span class="string">' Invalid sample; drawing another sample'</span>);
0067       my_result = <a href="es_sample_model.html" class="code" title="function [result, es_options, es_constraints] = es_sample_model(N, W, ind_ext, es_constraints, es_options)">es_sample_model</a>(N,W,ind_ext,es_constraints,es_options);
0068       accept = feval(select_function,my_result,function_args);
0069     <span class="keyword">end</span>
0070   <span class="keyword">end</span>
0071   my_output = feval(output_function,my_result,function_args);
0072   <span class="keyword">if</span> isempty(score_function),
0073     output_list{it} = my_output;
0074   <span class="keyword">else</span>
0075     my_score = feval(score_function,my_result,function_args);
0076     <span class="keyword">if</span> [my_score &gt; old_score] + [rand &lt; exp(my_score - old_score)] 
0077       output_list{it} = my_output;
0078       my_score = old_score;
0079     <span class="keyword">else</span>,
0080       output_list{it} = output_list{it-1};
0081     <span class="keyword">end</span>
0082   <span class="keyword">end</span>
0083 <span class="keyword">end</span>
0084 
0085 <span class="comment">% -----------------------------------------------</span>
0086 <span class="comment">% put the output list into a vector / matrix / tensor</span>
0087 
0088 output = [];
0089 
0090 <span class="keyword">if</span> isscalar(output_list{1}),
0091 
0092   <span class="keyword">for</span> it = 1:length(output_list),
0093     output(it,:) = output_list{it};
0094   <span class="keyword">end</span>
0095 
0096 <span class="keyword">else</span>
0097 
0098   <span class="keyword">if</span> isvector(output_list{1}),
0099     <span class="keyword">if</span> size(output_list{1},2) ==1,
0100       <span class="keyword">for</span> it = 1:length(output_list),
0101         output(:,it) = output_list{it};
0102       <span class="keyword">end</span>
0103     <span class="keyword">else</span>
0104       <span class="keyword">for</span> it = 1:length(output_list),
0105         output(:,it) = output_list{it};
0106       <span class="keyword">end</span>
0107     <span class="keyword">end</span>
0108   
0109   <span class="keyword">else</span> <span class="comment">% tensor</span>
0110 
0111     <span class="keyword">if</span> isnumeric(output_list{1}),
0112       <span class="keyword">for</span> it = 1:length(output_list),
0113         output(:,:,it) = output_list{it};
0114       <span class="keyword">end</span>
0115     <span class="keyword">end</span>
0116   <span class="keyword">end</span>
0117 
0118 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 10-Apr-2013 10:44:20 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>